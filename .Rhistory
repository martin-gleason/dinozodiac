dbSendQuery(con, set_new_source_default)
dbSendQuery(con, set_source_seq_owner)
dbWriteTable(con, "scopes", all_scopes, overwrite = TRUE)
#alter column to serial
number <- dbGetQuery(con, "SELECT MAX(scope_id) FROM scopes;")
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/db_work.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/db_work.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/scope_analysis.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/scope_analysis.R', echo=TRUE)
library(tidyverse)
library(DBI)
library(odbc)
library(tidytext)
library(keras)
library(here)
library(tokenizers)
min_target <- 100000
preferred <- 1000000
dz <- config::get(file = 'connections/dinozodiac.yml')
con <- DBI::dbConnect(odbc::odbc(),
Driver = dz$dinozodiac$driver,
Servere = dz$dinozodiac$server,
UID = dz$dinozodiac$uid,
PWD = dz$dinozodiac$pwd,
Port = dz$dinozodiac$port,
Database = dz$dinozodiac$database
)
#creating tables signs and horoscopes aka scopes
signs <- dbReadTable(con, "signs")
#corpus of horoscopes
scopes <- dbReadTable(con, "scopes") %>%
select(scope) %>%
mutate(count = str_count(scope, "\\w+"),
char_count = nchar(scope))
#character corpus
scopes_corpus <- scopes %>%
select(scope) %>%
pull() %>%
str_c(collapse = " ") %>%
tokenize_characters(lowercase = FALSE,
strip_non_alphanum = FALSE,
simplify = TRUE)
print(sprintf("Corpus length: %d", length(scopes_corpus)))
averages <- scopes %>%
summarize(`avg words` = mean(count),
`fewest words` = min(count),
`most words` = max(count),
mean_char = mean(char_count),
min_char = min(char_count),
max_char = max(char_count))
length(scopes_corpus)/min_target
hscope_number <- min_target/averages$mean_char
per_sign <- hscope_number * 12
dino_scopes_full <- dbReadTable(con, "scopes") %>%
left_join(signs, by = c("sign_id" = "sign_id"))
#for analyzing horoscopes.com
dino_h <- dino_scopes_full %>%
filter(source_id == 1)
#for astrology.net
dino_astrology <- dino_scopes_full %>%
filter(source_id == 2)
#custom function for divvying up by sign
#next version use quo and !! to make more robust
by_sign <- function(df,...){
ds <- df %>% select(sign_id) %>%
unique() %>%
max()
list_of_signs <- vector(mode = "list", length = ds)
list_of_signs <- split(df, f = df$sign_id)
names(list_of_signs) <- df %>% select(greekname) %>%
unique() %>%
pull()
return(list_of_signs)
}
allscopes <- dino_scopes_full %>% by_sign()
bing <- get_sentiments("bing")
nrc <- get_sentiments("nrc")
nrc_sentiments <- nrc$sentiment %>% unique()
nrc_positive <- nrc %>%
filter(sentiment == "positive")
nrc_joy <- nrc %>%
filter(sentiment == "joy")
(stop_words)
(stop_words)
cancer_positive <-tidy_cancer %>%
inner_join(nrc_positive) %>%
count(word, sort = TRUE)
tidy_cancer <- allscopes$Cancer %>%
unnest_tokens(word, scope) %>%
select(date, dinoname, word) %>%
anti_join(stop_words)
cancer_positive <-tidy_cancer %>%
inner_join(nrc_positive) %>%
count(word, sort = TRUE)
cancer_joy <- tidy_cancer %>%
inner_join(nrc_joy) %>%
count(word, sort = TRUE)
scope_sentiment <- dino_scopes_full %>%
unnest_tokens(word, scope) %>%
select(date, dinoname, word) %>%
anti_join(stop_words) %>%
inner_join(bing) %>%
group_by(date)%>%
count(word, dinoname, sentiment) %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative)
scope_sentiment %>%
filter(sentiment == 5)
min(scope_sentiment$sentiment)
max(scope_sentiment$sentiment)
gg_scope <-scope_sentiment %>% ggplot(aes(x = date, y = sentiment, fill = dinoname)) +
geom_bar(stat = "identity", aes(alpha = .5)) +
facet_wrap(~dinoname)+
theme_minimal()
View(scope_sentiment %>% count(word, sort = TRUE))
ggsave("output/scope_sentiment_eda.png", gg_scope, width = 15, height = 8.5, units = "in")
source('~/Local Dev Projects/dinozodiac/scripts/scope_analysis.R', echo=TRUE)
gg_scope
cancer_positive <-tidy_cancer %>%
inner_join(nrc_positive) %>%
count(word, sort = TRUE)
cancer_joy
min(scope_sentiment$sentiment)
allscopes %>%
filter(sentiment == -3)
allscopes$Aries %>%
filter(sentiment == -3)
min_sentiment <- min(scope_sentiment$sentiment)
scope_sentiment %>%
filter(sentiment == min_sentiment)
scope_sentiment %>% ggplot(aes(x = date, y = sentiment, fill = dinoname)) +
geom_bar(stat = "identity", aes(alpha = .5)
theme_gray()
scope_sentiment %>% ggplot(aes(x = date, y = sentiment, fill = dinoname)) +
geom_bar(stat = "identity", aes(alpha = .5))
scope_sentiment %>% ggplot(aes(x = date, y = sentiment, fill = dinoname)) +
geom_bar(stat = "identity", aes(alpha = .5, position = "dodge"))
scope_sentiment %>% ggplot(aes(x = date, y = sentiment, fill = dinoname)) +
geom_bar(stat = "identity", aes(alpha = .5),  position = "dodge"))
scope_sentiment %>% ggplot(aes(x = date, y = sentiment, fill = dinoname)) +
geom_bar(stat = "identity", aes(alpha = .5),  position = "dodge")
source('~/Local Dev Projects/dinozodiac/scripts/scope_analysis.R')
source('~/Local Dev Projects/dinozodiac/scripts/scope_analysis.R')
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R', echo=TRUE)
#MODEL
create_model <- function(chars, max_length){
keras_model_sequential() %>%
layer_lstm(128, input_shape = c(max_length, length(chars))) %>%
layer_dense(length(chars)) %>%
layer_activation("softmax") %>%
compile(
loss = "categorical_crossentropy",
optimizer = optimizer_rmsprop(lr = 0.01)
)
}
iterate_model <- function(model, text, chars, max_lenght, diversity, vectors, iterations){
for(iteration in 1:iterations){
message(sprintf("iteration: %02d ---------------\n\n", iteration))
fit_model(model, vectors)
for(diversity in c(0.2, 0.5, 1)){
message(sprintf("diversity: %f ---------------\n\n", iteration))
current_phrase <- 1:10 %>%
map_chr(function(x) generate_phrase(model, text, chars, max_length, diverstiy))
message(current_phrase, sep = "\n")
message("\n\n")
}
}
NULL
}
model <- create_model(chars, max_length)
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R', echo=TRUE)
dinoset <- map(
seq(1, length(scopes_text) - max_length -1, by = 3),
~list(sentence = scopes_text[.x:(.x + max_length - 1)],
next_char = scopes_text[.x + max_length])
)
tensorflow::install_tensorflow()
install_keras(method = c("auto", "virtualenv", "conda"),
conda = "auto", version = "default", tensorflow = "default",
extra_packages = c("tensorflow-hub"))
install_keras(method = c("auto", "virtualenv", "conda"),
conda = "auto", version = "default", tensorflow = "default",
extra_packages = c("tensorflow-hub"))
install_keras(method = c("auto", "virtualenv", "conda"),
conda = "auto", version = "default", tensorflow = "default",
extra_packages = c("tensorflow-hub"))
keras::install_keras(method = c("auto", "virtualenv", "conda"),
conda = "auto", version = "default", tensorflow = "default",
extra_packages = c("tensorflow-hub"))
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R', echo=TRUE)
reticulate::py_config()
tensorflow::install_tensorflow()
keras::install_keras(method = c("auto", "virtualenv", "conda"),
conda = "auto", version = "default", tensorflow = "default",
extra_packages = c("tensorflow-hub"))
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/db_work.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
#cleaning and saving to df
library(tidyverse)
library(here)
url_pattern <- "http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+"
date_pattern <- "(?<=<span class=date>)(.*?)(?=:)"
paragraph_pattern <- "(?<=<p>)(.*?)(?=</p>)"
strong_date_pattern <- "(?<=<strong>)(.*?)(?=</strong>)"
sign_header <- "(?<=<h1>)(.*?)(?=</.*?>)"
h_scope <- "Horoscope"
url_site <- "^(([^:/?#]+):)?(//([^/?#]*))?"
#create list of files function
data_files <- function(dir = "astrohistory", filename, sep = "/"){
fp <- paste0(dir, sep, filename)
list_of_files <- lapply(Sys.glob(fp), read.delim)
return(list_of_files)
}
files <- data_files("astrohistory", "astrologyCom*.txt")
bulk_read <- function(files = files){
source <- files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
date <- files %>%
str_extract_all(date_pattern) %>%
unlist() %>%
as.Date.character("%b %d, %Y")
scope <- files %>%
str_extract_all(paragraph_pattern) %>%
unlist() %>%
str_remove("<span class=date>(.*?)</span>") %>%
str_trim() %>%
na.omit()
sign <- basename(source) %>%
str_remove(".html") %>%
str_to_title()
df <- tibble(source, date, scope, sign)
return(df)
}
astrology_com <- bulk_read(files)
## horoscope.com
dat <- data_files("astrohistory", "horor*.txt")
hscope <- function(files){
scope <- files %>%
str_extract_all(paragraph_pattern) %>%
unlist() %>%
na.omit()
source <- files %>%
str_extract_all(url_pattern) %>%
unlist() %>%
na.omit()
date <- scope %>%
str_extract_all(strong_date_pattern) %>%
unlist() %>%
as.Date.character("%b %d, %Y") %>%
na.omit()
sign <- files %>%
str_extract_all(sign_header) %>%
unlist() %>%
str_remove(h_scope) %>%
str_trim() %>%
na.omit()
scope <- scope %>%
str_remove_all(strong_date_pattern) %>%
str_remove("<strong>") %>%
str_remove("</strong>") %>%
str_remove(" - ")
df <- tibble(source, date, scope, sign)
return(df)
}
hororscope_com <- dat %>% hscope()
all_scopes <- hororscope_com %>% bind_rows(astrology_com)
signs_cleaned <- all_scopes$sign %>% unique()
dino_signs <- c("Allosaurus","Triceratops","Pterodactylus",
"Ankylosaurus", "Tyrannosaurus Rex", "Brontosaurus",
"Rhamphorhynchus", "Spinosaurus", "Velociraptor",
"Stegosaurus", "Quetzalcatlus", "Mosasaurus")
dino_signs[4:5]
matched_signs <- tibble(signs_cleaned, dino_signs) %>%
mutate(sign_id = 1:nrow(.)) %>%
select(sign_id, greekname = signs_cleaned, dinoname = dino_signs)
matched_signs %>% select(sign_id)
View(matched_signs)
url <- all_scopes$source %>%
str_extract(url_site) %>%
unique()
url_id <- length(url)
sources <- url %>%
tibble(url = .,
sourceid = seq(1:url_id)) %>%
select(source_id = sourceid, url)
sources
all_scopes <- all_scopes %>%
left_join(matched_signs, by = c("sign" = "greekname"))
all_scopes
all_scopes <- all_scopes %>%
mutate(source_site = str_extract(source, url_site)) %>%
left_join(sources, by = c("source_site" = "url")) %>%
mutate(scope_id = 1:nrow(.)) %>%
select(scope_id, source_id, date, scope, sign_id)
all_scopes
#QA
today <- all_scopes %>%
filter(date == lubridate::today())
all_scopes$sign %>%unique()
all_scopes
all_scopes$sign_id %>% unique()
source('~/Local Dev Projects/dinozodiac/scripts/db_work.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
#cleaning and saving to df
library(tidyverse)
library(here)
url_pattern <- "http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+"
date_pattern <- "(?<=<span class=date>)(.*?)(?=:)"
paragraph_pattern <- "(?<=<p>)(.*?)(?=</p>)"
strong_date_pattern <- "(?<=<strong>)(.*?)(?=</strong>)"
sign_header <- "(?<=<h1>)(.*?)(?=</.*?>)"
h_scope <- "Horoscope"
url_site <- "^(([^:/?#]+):)?(//([^/?#]*))?"
#create list of files function
data_files <- function(dir = "astrohistory", filename, sep = "/"){
fp <- paste0(dir, sep, filename)
list_of_files <- lapply(Sys.glob(fp), read.delim)
return(list_of_files)
}
files <- data_files("astrohistory", "astrologyCom*.txt")
bulk_read <- function(files = files){
source <- files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
date <- files %>%
str_extract_all(date_pattern) %>%
unlist() %>%
as.Date.character("%b %d, %Y")
scope <- files %>%
str_extract_all(paragraph_pattern) %>%
unlist() %>%
str_remove("<span class=date>(.*?)</span>") %>%
str_trim() %>%
na.omit()
sign <- basename(source) %>%
str_remove(".html") %>%
str_to_title()
df <- tibble(source, date, scope, sign)
return(df)
}
astrology_com <- bulk_read(files)
files <- data_files("astrohistory", "astrologyCom*.txt")
source <- files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
#cleaning and saving to df
library(tidyverse)
library(here)
url_pattern <- "http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+"
date_pattern <- "(?<=<span class=date>)(.*?)(?=:)"
paragraph_pattern <- "(?<=<p>)(.*?)(?=</p>)"
strong_date_pattern <- "(?<=<strong>)(.*?)(?=</strong>)"
sign_header <- "(?<=<h1>)(.*?)(?=</.*?>)"
h_scope <- "Horoscope"
url_site <- "^(([^:/?#]+):)?(//([^/?#]*))?"
#create list of files function
data_files <- function(dir = "astrohistory", filename, sep = "/"){
fp <- paste0(dir, sep, filename)
list_of_files <- lapply(Sys.glob(fp), read.delim)
return(list_of_files)
}
files <- data_files("astrohistory", "astrologyCom*.txt")
bulk_read <- function(files = files){
source <- files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
date <- files %>%
str_extract_all(date_pattern) %>%
unlist() %>%
as.Date.character("%b %d, %Y")
scope <- files %>%
str_extract_all(paragraph_pattern) %>%
unlist() %>%
str_remove("<span class=date>(.*?)</span>") %>%
str_trim() %>%
na.omit()
sign <- basename(source) %>%
str_remove(".html") %>%
str_to_title()
df <- tibble(source, date, scope, sign)
return(df)
}
astrology_com <- bulk_read(files)
astrology_com <- bulk_read(files)
astrology_com <- bulk_read(files)
## horoscope.com
dat <- data_files("astrohistory", "horor*.txt")
hscope <- function(files){
scope <- files %>%
str_extract_all(paragraph_pattern) %>%
unlist() %>%
na.omit()
source <- files %>%
str_extract_all(url_pattern) %>%
unlist() %>%
na.omit()
date <- scope %>%
str_extract_all(strong_date_pattern) %>%
unlist() %>%
as.Date.character("%b %d, %Y") %>%
na.omit()
sign <- files %>%
str_extract_all(sign_header) %>%
unlist() %>%
str_remove(h_scope) %>%
str_trim() %>%
na.omit()
scope <- scope %>%
str_remove_all(strong_date_pattern) %>%
str_remove("<strong>") %>%
str_remove("</strong>") %>%
str_remove(" - ")
df <- tibble(source, date, scope, sign)
return(df)
}
hororscope_com <- dat %>% hscope()
all_scopes <- hororscope_com %>% bind_rows(astrology_com)
astrology_com <- bulk_read(files)
bulk_read <- function(files = files){
source <- files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
date <- files %>%
str_extract_all(date_pattern) %>%
unlist() %>%
as.Date.character("%b %d, %Y")
scope <- files %>%
str_extract_all(paragraph_pattern) %>%
unlist() %>%
str_remove("<span class=date>(.*?)</span>") %>%
str_trim() %>%
na.omit()
sign <- basename(source) %>%
str_remove(".html") %>%
str_to_title()
df <- tibble(source, date, scope, sign)
return(df)
}
files <- data_files("astrohistory", "astrologyCom*.txt")
bulk_read(files)
debugSource('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R')
url_pattern <- "http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+"
files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
url_pattern <- "http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))"
files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
url_pattern <- "http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+"
files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
files %>%
str_extract_all(pattern = "https://www.astrology.com/horoscope/daily/+") %>%
unlist()
files %>%
str_extract_all(pattern = "https://www.astrology.com/horoscope/daily/") %>%
unlist()
files %>%
str_extract_all(pattern = url_site) %>%
unlist()
files %>%
str_extract_all(pattern = url_site) %>%
unlist()
files %>%
str_extract_all(pattern = url_site)
files %>%
str_extract_all(pattern = url_site) %>%
unlist()
debugSource('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
()
files %>%
str_extract_all(pattern = url_site) %>%
unlist()
files %>%
str_extract_all(pattern = url_pattern) %>%
unlist()
files %>%
str_extract_all(pattern = url_pattern)
files %>%
str_extract_all(pattern = url_pattern)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
files %>%
str_extract_all(pattern = url_pattern)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/db_work.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/db_work.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/db_work.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/cleaning_db_prep.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/db_work.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R')
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R')
??tf_config
debugSource('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R', echo=TRUE)
source('~/Local Dev Projects/dinozodiac/scripts/tidytextmodel.R', echo=TRUE)
